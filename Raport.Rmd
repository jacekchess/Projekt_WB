---
title: "Praca domowa 2"
author: "Agata Makarewicz, Martyna Majchrzak, Jacek Wiśniewski"
date: "27 04 2020"
output: html_document
---

```{r setup, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = FALSE, inlude=FALSE)
source('evaluate_imputations.R')
source('load_datasets.R')
```


# Introduction 

The aim of this report is to measure the influence of five different imputation methods on the performance of a Gradient Boosting Machine classification model. To achieve this goal the following experiment will be conducted on 12 datasets, gathered mostly from OpenML and some from the imputation packages. 

# Methodology 

In the following table are presented the datasets used for this experiment, along with their OpenML ID number, name, number of instances and number of features. The datasets vary in size and number of missing values.


```{r}
data_nr<-c("1590", "188",  "23381", "27", "29", "38", "4", "40536", "55", "56", "6332", "944")
data_name<-c("adult", "eucalyptus", "dresses-sales", "colic", "credit-approval", "sick", "labor", "SpeedDating", "hepatitis", "vote", "cylinder-bands", "echoMonths" )
nr_instances<-c(48842, 736, 500, 368, 690, 3772, 57, 8378, 155, 435, 540, 130)
nr_features<-c(13, 16, 13, 20, 16, 28, 17, 123, 20, 17, 34, 10)

datasets<-data.frame(cbind(data_nr, 
                     data_name, 
                     nr_instances, 
                     nr_features))
# colnames(datasets)
knitr::kable(datasets)
```

To conduct the experiment a function `evaluate_imputations()` placed in the script with the same name was implemented. The function receives a single dataset and the name of the target variable, and returns a matrix with 5 imputations as rows and 2 performance measures: AUC and Balanced Accuracy, as columns.


## Train and test set

Each dataset is splitted into train set (80% of observation) and train set (20% of observation).

## Imputation

The imputations, that were performed on those datasets include:

 - mean/mode imputation
 - predictive mean matching (mice package)
 - k-nearest neighbours (VIM package)
 - hotdeck (VIM package)
 - softImpute with median/mode imputation (softImpute package)

### mean/mode imputation 

### mice

### k-nearest neighbours (VIM package)

An aggregation of the k values of the nearest neighbors is used as imputed value. The kind
of aggregation depends on the type of the variable.

### hotdeck (VIM package)

### softImpute with median/mode imputation

## Modelling 

The modelling was performed using the mlr3 package, with Recursive Partitioning And Regression Trees learner.


# Results

```{r evaluating_imputations, cache=TRUE, warning=FALSE}

# numery wszystkich zbiorów: 1018, 1590, 188, 23381, 27, 29, 38, 4, 40536, 41278, 55, 56, 6332, 944

# numery używanych obecnie: 1590, 188, 23381, 27, 29, 38, 4, 40536, 55, 56, 6332, 944

###################### GIT ZBIORKI: 944, 56, 55, 38, 27, 188, 29, 4

evaluation_944 <- evaluate_imputations(dataset944,target944)
evaluation_56 <- evaluate_imputations(dataset56,target56) 
evaluation_55 <- evaluate_imputations(dataset55,target55)
evaluation_38 <- evaluate_imputations(dataset38,target38) # długi missForest 
evaluation_27 <- evaluate_imputations(dataset27,target27)
evaluation_188 <- evaluate_imputations(dataset188,target188)
evaluation_29 <- evaluate_imputations(dataset29,target29) 
# działa przy ustawieniu pmm w mice, inaczej nie
evaluation_4 <- evaluate_imputations(dataset4,target4) 
# przy rm rows zeruje sie zbiór testowy, treningowy ma jeden wiersz 

############################### PROBLEMY: 1018


# evaluation_1018 <- evaluate_imputations(dataset1018,target1018)
# przy rm rows zeruje sie zbiór testowy
# przy mice nie działa dla "pmm"

############################### DUŻE ZBIORKI: 41278, 6332, 40536, 1590, 23381

# na potrzeby duzych zbiorów w mice jest 1x1 , pmm i dodatkowy parametr zeby te weights sie nie wywalało 
# wykomentowane bo długo sie mielą i wywalaja sesje R czasami xd
# testowałam funkcję ręcznie na data_test dla kazdego zbioru bo dla nich jeszcze w miare sie robiło
# wiec mysle ze na train tez powinno działać xd

evaluation_6332 <- evaluate_imputations(dataset6332,target6332) 

# ten zbiór jest zjebany bo mega duży, wywalił mi sesje 3 razy wiec moze go olejmy 
# evaluation_41278 <- evaluate_imputationss(dataset41278,target41278) 

evaluation_40536 <- evaluate_imputations(dataset40536,target40536) 

evaluation_23381 <- evaluate_imputations(dataset23381,target23381) 

evaluation_1590 <- evaluate_imputations(dataset1590,target1590) 

```

```{r}
# 1590, 188, 23381, 27, 29, 38, 4, 40536, 55, 56, 6332, 944
auc_combined<-as.data.frame(
  rbind(
  evaluation_1590$auc,
  evaluation_188$auc,
  evaluation_23381$auc,
  evaluation_27$auc,
  evaluation_29$auc,
  evaluation_38$auc,
  evaluation_4$auc,
  evaluation_40536$auc,
  evaluation_55$auc,
  evaluation_56$auc,
  evaluation_6332$auc,
  evaluation_944$auc,
))
rownames(auc_combined)<-c('insert_mean','mice_pmm','vim_knn','vim_hotdeck','softImpute')

bacc_combined<-as.data.frame(
  rbind(
  evaluation_1590$bacc,
  evaluation_188$bacc,
  evaluation_23381$bacc,
  evaluation_27$bacc,
  evaluation_29$bacc,
  evaluation_38$bacc,
  evaluation_4$bacc,
  evaluation_40536$bacc,
  evaluation_55$bacc,
  evaluation_56$bacc,
  evaluation_6332$bacc,
  evaluation_944$bacc,
))

rownames(bacc_combined)<-c('insert_mean','mice_pmm','vim_knn','vim_hotdeck','softImpute')

```


